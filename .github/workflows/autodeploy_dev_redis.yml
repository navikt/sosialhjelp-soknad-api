name: Auto-deploy redis dev-sbs
on:
  push: # Deploys automatically to dev-sbs, dev-gcp and labs-gcp if there is a change in any redis files.
    paths:
      - "web/nais/redis-config.yml"
      - "web/nais/redisexporter.yml"
      - ".github/workflows/autodeploy_dev_redis.yml"
    branches-ignore:
      - 'master'
    tags-ignore:
      - "**" # Don't build any tags

env:
  CI: true

jobs:
  deploy-dev-sbs:
    name: Auto-deploy redis to dev-sbs
    runs-on: ubuntu-latest
    steps:
      - name: Hente kode
        uses: actions/checkout@v2
      - name: Deploy
        uses: nais/deploy/actions/deploy@v1
        env:
          APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CLUSTER: dev-sbs
          TEAM: teamdigisos
          RESOURCE: "web/nais/redis-config.yml,web/nais/redisexporter.yml"

  deploy-dev-gcp:
    name: Auto-deploy redis to dev-gcp
    runs-on: ubuntu-latest
    steps:
      - name: Hente kode
        uses: actions/checkout@v2
      - name: Deploy
        uses: nais/deploy/actions/deploy@v1
        env:
          APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CLUSTER: dev-gcp
          TEAM: teamdigisos
          RESOURCE: "web/nais/redis-config.yml,web/nais/redisexporter.yml"

  deploy-labs-gcp:
    name: Auto-deploy redis to labs-gcp
    runs-on: ubuntu-latest
    steps:
      - name: Hente kode
        uses: actions/checkout@v2
      - name: Deploy
        uses: nais/deploy/actions/deploy@v1
        env:
          APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CLUSTER: labs-gcp
          TEAM: teamdigisos
          RESOURCE: "web/nais/redis-config.yml,web/nais/redisexporter.yml"
