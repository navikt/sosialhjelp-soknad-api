<div class="skjemaramme" data-ng-controller="ModusCtrl">
    <div ng-form="arbeidsforholdForm" class="skjemainnhold" data-ng-controller="ArbeidsforholdCtrl"
         data-ng-submit="validerArbeidsforhold(arbeidsforholdForm)">
        <div form-errors/>
        <p class="arbeidsforhold-informasjonstekst" cmstekster="arbeidsforhold.informasjon"/>

        <div data-ng-repeat="af in arbeidsforhold" data-ng-class="{'last': $last}">
            <div class="arbeidsforhold" data-ng-show="arbeidsforholdetErIkkeIRedigeringsModus($index)">
                <p class="arbeidsforhold-dato">{{ af.varighetFra | date:'dd.MM.yyyy'}} - {{
                    af.varighetTil | date:'dd.MM.yyyy'}}</p>

                <p class="arbeidsforhold-arbeidsgivernavn-overskrift">{{ af.navn }}</p>

                <div class="arbeidsforhold-land-sluttaarsak-blokk">
                    <span class="svar-oppsummering-label" cmstekster="arbeidsforhold.arbeidsgiver.land"/>
                    <span class="svar-oppsummering-label-svar">{{ af.land }}</span>
                    <span class="svar-oppsummering-deler"> | </span>
                    <span class="svar-oppsummering-label" cmstekster="arbeidsforhold.arbeidsgiver.sluttaarsak"/>
                    <span class="svar-oppsummering-label-svar">{{ af.sluttaarsak.navn }}</span>
                </div>

                <div class="arbeidsgiver-oppsummering-sluttaarsaker">
                    <div data-ng-include="af.sluttaarsak.oppsummeringsurl"></div>
                </div>

                <p class="arbeidsforhold-oppsummering-endre-slett lenker-dot" data-ng-show="hvisIRedigeringsmodus()">
                        <span><a href data-ng-click="slettArbeidsforhold(af)"
                                 cmstekster="arbeidsforhold.slettarbeidsforhold"/></span>
                        <span><a href data-ng-click="endreArbeidsforhold($index, arbeidsforholdForm)"
                                 cmstekster="arbeidsforhold.endrearbeidsforhold"/></span>
                </p>
            </div>

            <div class="spm-boks vertikal" data-ng-if="posisjonForArbeidsforholdUnderRedigering == $index"
                 data-ng-form="leggTilArbeidsforholdForm" data-ng-controller="LeggTilArbeidsforholdCtrl">
                <div form-errors/>
                <div class="arbeidsforhold-spm">
                    <div class="form-linje">
                        <label>
                            <span cmstekster="arbeidsforhold.arbeidsgiver.navn"/>
                            <input name="arbeidsgivernavn" required
                                   error-messages="'arbeidsforhold.arbeidsgiver.navn.feilmelding'" type="text"
                                   data-ng-model="af.navn">
                            <span class="melding"/>
                        </label>
                    </div>

                    <div class="form-linje">
                        <label>
                            <span cmstekster="arbeidsforhold.arbeidsgiver.land"/>
                            <select name="arbeidsgiverland" data-ng-model="af.land"
                                    data-ng-options="item for item in landService.result"
                                    error-messages="'arbeidsforhold.arbeidsgiver.land.feilmelding'" required>
                                <option value="" cmstekster="arbeidsforhold.arbeidsgiver.landDefault"/>
                            </select>
                            <span class="melding"/>
                        </label>
                    </div>


                    <div class="varighet">
                        <div>
                            <label cmstekster="arbeidsforhold.arbeidsgiver.varighetFra"/>
                            <input type="text" name="varighetFra" ui-date ui-date-format ng-model="af.varighetFra"
                                   data-ng-change="validateTilFraDato(af)"
                                   error-messages="'arbeidsforhold.arbeidsgiver.varighetFra.feilmelding'" required/>
                        </div>
                        <div>
                            <label cmstekster="arbeidsforhold.arbeidsgiver.varighetTil"/>
                            <span data-ng-show="datoError" style="color:red"
                                  cmstekster="arbeidsforhold.error.datoTilFra"/>
                            <input type="text" name="varighetTil" ui-date ui-date-format ng-model="af.varighetTil"
                                   data-ng-change="validateTilFraDato(af)"
                                   error-messages="'arbeidsforhold.arbeidsgiver.varighetTil.feilmelding'" required/>
                        </div>
                    </div>

                    <div class="form-linje">
                        <label>
                            <span cmstekster="arbeidsforhold.arbeidsgiver.sluttaarsak"/>
                            <select id="sluttaarsak_id" type="text" name="sluttaarsak" data-ng-model="af.sluttaarsak"
                                    data-ng-options="t.navn for t in templates"
                                    error-messages="'arbeidsforhold.arbeidsgiver.sluttaarsak.feilmelding'" required>
                                <option value="" cmstekster="arbeidsforhold.arbeidsgiver.sluttaarsakDefault"/>
                            </select>
                            <span class="melding"/>
                        </label>
                    </div>

                    <div data-ng-show="af.sluttaarsak">
                        <div data-ng-include="af.sluttaarsak.url"/>
                    </div>
                </div>
                <div class="knapper-opprett-arbeidsforhold">
                    <input class="knapp-hoved-liten" name="lagre" cmstekster="arbeidsforhold.lagre" type="submit"
                           id="arbeidsgiverLagre"
                           data-ng-click="lagreArbeidsforhold(af, arbeidsforholdForm)">

                    <a class="arbeidsforhold-avbryt" href cmstekster="arbeidsforhold.avbryt"
                       data-ng-click="avbrytEndringAvArbeidsforhold(af, arbeidsforholdForm)"/>
                </div>
            </div>

        </div>
        <div class="knapper-arbeidsforhold">
            <div id="legg-til" data-ng-show="hvisIRedigeringsmodus()">
                <a href class="knapp-leggtil-liten" data-ng-click="nyttArbeidsforhold($event, arbeidsforholdForm)"
                   cmstekster="arbeidsforhold.nyttarbeidsforhold"/>
            </div>

            <div id="har-ikke-jobbet" data-ng-show="harIkkeLagretArbeidsforhold()">
                <div navcheckbox data-ng-model="soknadData.fakta.harIkkeJobbet.value"
                     modus="data.redigeringsModus"
                     inputname="harIkkeJobbet" label='arbeidsforhold.harIkkeJobbet'
                     endret="toggleRedigeringsmodus(arbeidsforholdForm)"/>
            </div>

            <div spmblokkferdig
                 nokkel="arbeidsforhold"
                 modus="data.redigeringsModus"
                 submit-method="validerArbeidsforhold(arbeidsforholdForm)"/>
        </div>
    </div>
</div>


